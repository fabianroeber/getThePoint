<ui:composition template="../template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<ui:define name="content">
		<h:form rendered="#{menuBean.hasLehrenderRole()}">
			<p:dataTable rowIndexVar="frageRow" id="fragen" var="frage"
				value="#{frageBean.fragen}" editable="true" tableStyle="width:auto">
				<p:column headerText="Frage">
					<p:inplace id="ajax" editor="true">
						<p:inputText value="#{frage.text}" />
					</p:inplace>
				</p:column>
				<p:column headerText="Antwortmöglichkeiten">
					<p:panel id="horizontal" header="#{frage.loesung.text}" 
						collapsed="true" toggleTitle="Antwortmöglichkeiten bearbeiten"
						toggleable="true">
						<p:dataTable id="antwortmoeg" rowIndexVar="antwortRow"
							draggableColumns="true" value="#{frage.antwortmoeglichkeiten}"
							var="antwort" styleClass="hide-column-names"
							selection="#{frage.loesung}" selectionMode="single"
							type="ordered" rowKey="#{antwort.id}" tableStyle="width:auto"
							rendered="#{frage.antwortmoeglichkeiten.size() > 0}">
							<p:column>
								<p:inplace id="antwortbearbeiten" editor="true" event="dblclick">
									<p:inputText value="#{antwort.text}"></p:inputText>
								</p:inplace>
								<p:tooltip id="tooltipAntwort" for="antwortbearbeiten"
									value="Doppelklick, um Antwortmöglichkeit zu bearbeiten" />
							</p:column>
							<p:column>
								<p:commandButton icon="ui-icon-trash" title="Entfernen"
									action="#{frageBean.deleteAntwortmoeg(frageRow, antwortRow)}"></p:commandButton>
							</p:column>
						</p:dataTable>
						<p:commandButton icon="ui-icon-plus" title="Hinzufügen"
							action="#{frageBean.addAntwortmoeg(frageRow)}"
							update="antwortmoeg" rendered="#{!frage.hasMaxAntworten()}" />
					</p:panel>
				</p:column>
				<p:column headerText="Kategorie">
					<p:selectOneMenu value="#{frage.kategorie}"
						converter="omnifaces.SelectItemsConverter">
						<f:selectItems value="#{frageBean.kategorien}" var="kateg"
							itemValue="#{kateg}" itemLabel="#{kateg.bezeichnung}"></f:selectItems>
					</p:selectOneMenu>
				</p:column>

				<p:column headerText="Bild">
					<p:commandButton id="imageBtn" icon="ui-icon-image" type="button" />
					<p:overlayPanel id="imagePanel" for="imageBtn" hideEffect="fade">
						<p:graphicImage value="#{frage.bild}"></p:graphicImage>
					</p:overlayPanel>

					<p:commandButton icon="ui-icon-folder-open"
						onclick="PF('d1').show();" title="Bild Hochladen"></p:commandButton>

				</p:column>
				<p:column headerText="Schwierigkeit">
					<p:outputLabel value="#{frage.schwierigkeit.text}"></p:outputLabel>
				</p:column>
			</p:dataTable>
			<br></br>
			<p:commandButton title="Neue Frage hinzufügen" icon="ui-icon-plus"
				action="#{frageBean.addFrage()}" update="fragen"></p:commandButton>
			<p:commandButton title="Speichern" id="save" update="fragen"
				icon="ui-icon-disk" />


		</h:form>
		<p:dialog id="bild" header="Bild hochladen" widgetVar="d1">
			<p:fileUpload fileUploadListener="#{frageBean.upload}"
				allowTypes="/(\.|\/)(gif|jpe?g|png)$/" sizeLimit="100000"
				description="Bild auswählen" />
			<p:commandButton value="Ok" onclick="PF('d1').hide();" type="button"
				update="lehrende"></p:commandButton>
		</p:dialog>
	</ui:define>

</ui:composition>